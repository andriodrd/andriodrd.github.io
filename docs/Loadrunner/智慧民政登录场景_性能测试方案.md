# 智慧民政登录场景_性能测试方案

## 性能测试脚本开发方案

1. 总体方案：

   1. 本次压力测试的测试策略是使用Loadrunner结合典型的被测接口业务数据流，通过生成一定数量的虚拟用户负载，模拟真实在线用户访问接口获取数据的业务模型，测试业务场景的事务响应时间和相关服务器的资源消耗情况。
   2. 测试过程中的测试脚本生成，用Loadrunner录制+手工优化生成。
   3. 录制设置的要求有：
      1. 选择合适的通信协议(Web HTTP/HTML协议)和浏览器(IE)
      2. 录制的脚本选择基于HTML-based script的web_url和web_submit_data
      3. Support charset选择UTF-8

   4. 手工优化的要求有：
      1. 定义事务与检查点，利用事务的LR_PASS与LR_FAIL结合web_reg_find函数检查事务是否通过，使脚本更加健壮
      2. 使用思考时间，统一将思考时间置于事务外
      3. 不使用集合点策略
      4. 使用参数化策略

2. 登录模块：

   1. 预先利用fiddler迁移一个合法登录用户用作登录（登陆的LSID和a的值是一一对应的，LSID的值可以获取但是a的值无法获取（平台原因），无法短时间内获取大量a的值，只能通过Fiddler抓包迁移a的值和对应的LSID的值，模拟真实大量用户名登陆场景的数据准备将耗费大量时间，故参数化仅模拟一个用户的登录注册）
   2. 模拟用户真实场景从打开登录页面开始，输入用户名和密码后点击登录进入首页完成登录的流程场景


## 性能测试场景设计方案

1. 先进行预测试
   1. 对于50个虚拟用户，ramp up设置为每30秒加5个用户，ramp down设置为每30秒减少5个用户，ramp up完成后持续时间为5分钟，这样总体运行时间约为15分钟
   2. 对于100虚拟用户，ramp up设置为每30秒加10个用户，ramp down设置为每30秒减少10个用户，ramp up完成后持续时间为5分钟，这样总体运行时间约为15分钟
   3. 不使用集合点，不适用ip欺骗，一次运行只测试一个脚本，负载生成器为本机
2. 经过预测试发现很容易达到100%，所以本次测试准备测试__个虚拟用户的负载测试
3. 同时，也由于CPU使用率偏高的问题，我们为所有测试步骤都没有设置思考时间，统一设置思考时间为2秒，以此来降低CPU的负荷，并且将思考时间置于事务外，这样响应时间中将不包含思考时间（如将思考时间置于事务内也可以，那么记得在Analysis中将思考时间扣除）
4. 使用ramp up和ramp down策略，用于分析随着虚拟用户的增加两个系统在响应时间上的变化情况
5. 对于50个虚拟用户，ramp up设置为每30秒加5个用户，ramp down设置为每30秒减少5个用户
6. 对于100虚拟用户，ramp up设置为每30秒加10个用户，ramp down设置为每30秒减少10个用户
7. ramp up完成后持续时间为5分钟，这样总体运行时间约为15分钟
8. 不使用集合点，不适用ip欺骗，一次运行只测试一个脚本，负载生成器为本机

## 重要分析指标

1. 前端性能指标
   1. 响应时间，快不快
   2. 响应的吞吐率（Throughput），每秒钟服务器的响应的大小
      - 服务端带宽
      - 客户端带宽
   3. TPS：每秒事务数，TPM->作用，设计性能需求
   4. HPS：每秒点击数，即每秒请求数，作用不大，减少HTTP请求 

2. 后端性能指标：
   1. CPU 
      1. CPU使用率 %Processsor Time，处理频率，内核数量，一级缓存，二级缓存，三级缓存的大小
      2. 处理器队列长度Processor Queue Length 最多为2*内核数
   2. 带宽

      1. 每秒接收的数据量，低于上行带宽/8
      2. 每秒发送的数据量，低于下行带宽/8

   3. 内存

      1. 内存使用率，可用内存数量（M）
      2. 内存的页交换频率page/sec，越低越好，内存和硬盘之间的数据交换

   4. 磁盘IO

      1. 硬盘使用率
      2. 硬盘队列长度

   5. 线程池

      1. 最大线程数
      2. 线程池：用于管理多线程的一种机制



## 其他考虑

1. 此次性能测试进行的是负载测试，目的是模拟用户的真实场景去评估系统的性能指标是否合理以及是否出现了性能瓶颈问题，若出现了性能瓶颈问题，进一步则进行压力测试，增加集合点策略，去除思考时间策略来进行性能瓶颈的定位以及进一步的性能优化问题，出个性能瓶颈的预案报告
2. jvm、ngix、tomcat、数据库的相应的指标监控，确定是否是瓶颈问题，复现以及调优